<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CGV CX</title>
    <link rel="stylesheet" href="https://sdk.telesip.vn/public/styles.css" />
    <script>
      function maskPhone(num) {
        if (!num) return "";
        num = num.trim();
        if (num.length <= 5) {
          return num[0] + "*".repeat(num.length - 1);
        }
        const prefix = num.slice(0, -7);
        const lastOne = num.slice(-3);
        return prefix + "****" + lastOne;
      }

      function applyMask(selector) {
        const observer = new MutationObserver(() => {
          document.querySelectorAll(selector).forEach((el) => {
            if (!el.dataset.masked) {
              let original = el.textContent || el.innerText;
              el.textContent = maskPhone(original);
              el.dataset.masked = "true";
            }
          });
        });
        observer.observe(document.body, {
          childList: true,
          subtree: true,
        });
        document.querySelectorAll(selector).forEach((el) => {
          if (!el.dataset.masked) {
            let original = el.textContent || el.innerText;
            el.textContent = maskPhone(original);
            el.dataset.masked = "true";
          }
        });
      }
      document.addEventListener("DOMContentLoaded", function () {
        applyMask(".pp-phone");
        applyMask(".pp-callee-info");
      });
    </script>
  </head>

  <body>
    <img alt="" />

    <script>
      (function (a, b) {
        var s = document.createElement("script");
        s.type = "text/javascript";
        s.async = true;
        // Use the global CGVSDK object exposed by the SDK script
        s.onload = () => {
          window.CGVSDK && (window.CGVSDK.k = a);
          b();
        };
        s.src = "https://sdk.telesip.vn/public/cgvsdk.v1.js";
        var x = document.getElementsByTagName("script")[0];
        x.parentNode.insertBefore(s, x);
      })("your_api_key", () => {
        console.log("CGV SDK Loaded");
      });

      (function () {
        const OriginalWebSocket = window.WebSocket;
        window.WebSocket = function (url, protocols) {
          const wsInstance = new OriginalWebSocket(url, protocols);
          wsInstance.addEventListener("message", function (event) {
            const lines = event.data.split("\r\n");
            const statusLine = lines[0];
            const statusCode = parseInt(statusLine.split(" ")[1]);

            if (statusCode >= 400 && statusCode < 600) {
              console.log("SIP Error:", statusLine);
              console.log("Full SIP message:", event.data);
            }
          });
          return wsInstance;
        };
      })();

      setTimeout(function () {
        let sdkOptions = {
          enableWidget: true,
          sipOnly: true,
          // sipDomain: 'gtg.vn:50061',
          // wsServer: "wss://cgvcall.mobilesip.vn:7444",
          // sipPassword: "NAWfYkHB!N"
          sipDomain: "gtg.vn:50061",
          wsServer: "wss://cgvcall.mobilesip.vn:7444",
          sipPassword: "NAWfYkHB!N",
        };

        // Create an instance of the SDK without shadowing the global CGVSDK constructor
        // let cgvSdkInstance = new window.CGVSDK('gtg.vn', 'xxx', '123123', {}, sdkOptions);
        let cgvSdkInstance = new window.CGVSDK(
          "gtg.vn",
          "xxx",
          "123123",
          {},
          sdkOptions,
        );

        window.makeCall = function (phoneNumber) {
          cgvSdkInstance.call(phoneNumber, {
            extraHeaders: ["x-PROCESS-ID: 123"],
          });
        };
      }, 5000);
    </script>
  </body>
</html>
